<?php declare(strict_types=1);

namespace Mammatus\Queue\Generated\Consumer;

use Mammatus\Queue\Generated\WorkerFactory;

/**
 * This class is generated by mammatus/queue, do not edit manually.
 * Or do, I'm not your parent, they will be overwritten next composer install/update ¯\_(ツ)_/¯.
 */
#[\Mammatus\Groups\Attributes\Group(\Mammatus\Groups\Type::Normal, '{{ worker.groupName }}')]
final class {{ worker.generateClassesClassNameSuffix }} implements \Mammatus\Groups\Contracts\LifeCycleHandler
{
    private ?\React\Promise\PromiseInterface $promise = null;

    public function __construct(
        private readonly \Mammatus\Queue\Consumer $consumer,
        private readonly \Psr\Log\LoggerInterface $logger,
    ) {
    }

    public static function group(): string
    {
        return '{{ worker.groupName }}';
    }

    public function start(): void
    {
//        $this->logger->debug('Starting consumer: {serverName}', ['serverName' => self::NAME]);
        $this->promise = $this->consumer->setupConsumer(WorkerFactory\{{ worker.generateClassesClassNameSuffix }}::create());
//        $this->logger->debug('Started server: {serverName}', ['serverName' => self::NAME]);
    }

    public function stop(): void
    {
//        $this->logger->debug('Stopping server: {serverName}', ['serverName' => self::NAME]);
        $this->promise?->cancel();
//        $this->logger->debug('Stopped server: {serverName}', ['serverName' => self::NAME]);
    }
}
